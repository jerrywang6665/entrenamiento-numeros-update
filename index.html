<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥¿è¯­æ•°å­—å¬åŠ›è®­ç»ƒ</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            margin: 10px;
        }
        #status {
            color: #FF2D55;
            min-height: 60px;
            font-size: 16px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>è¥¿è¯­æ•°å­—å¬åŠ›è®­ç»ƒ</h1>
    <div id="status">æ­£åœ¨æ£€æµ‹æµè§ˆå™¨å…¼å®¹æ€§...</div>
    
    <div id="supportedUI">
        <button id="playBtn">æ’­æ”¾æ•°å­—</button>
        <button id="autoBtn">è‡ªåŠ¨æ’­æ”¾</button>
    </div>
    
    <div id="unsupportedUI" class="hidden">
        <h3>ğŸ˜¢ æ‚¨çš„è®¾å¤‡ä¸æ”¯æŒè¯­éŸ³åŠŸèƒ½</h3>
        <p>è¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š</p>
        <ol style="text-align: left; margin: 20px;">
            <li>ä½¿ç”¨ <strong>Chrome/Firefox/Edge</strong> æœ€æ–°ç‰ˆ</li>
            <li>å®‰å“è®¾å¤‡éœ€å®‰è£… <strong>Google TTS</strong></li>
            <li>iOS 14+ éœ€ä½¿ç”¨ <strong>Safari</strong></li>
        </ol>
        <button onclick="window.location.reload()">é‡æ–°æ£€æµ‹</button>
    </div>

    <script>
        // 1. å…¼å®¹æ€§æ£€æµ‹
        function checkCompatibility() {
            const statusEl = document.getElementById('status');
            
            // åŸºç¡€APIæ£€æµ‹
            if (!window.speechSynthesis) {
                showUnsupported("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPI");
                return false;
            }
            
            // iOSç‰¹æ®Šæ£€æµ‹
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                statusEl.textContent = "iOSè®¾å¤‡éœ€ç”¨æˆ·äº¤äº’æˆæƒ...";
                return new Promise(resolve => {
                    document.body.addEventListener('touchstart', () => {
                        resolve(true);
                    }, { once: true });
                });
            }
            
            return true;
        }

        // 2. æ˜¾ç¤ºä¸æ”¯æŒç•Œé¢
        function showUnsupported(message) {
            document.getElementById('status').textContent = message;
            document.getElementById('supportedUI').classList.add('hidden');
            document.getElementById('unsupportedUI').classList.remove('hidden');
        }

        // 3. è¥¿è¯­æ•°å­—ç”Ÿæˆ (1-100)
        function getSpanishNum(num) {
            const nums = ["cero","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez",
                         "once","doce","trece","catorce","quince","diecisÃ©is","diecisiete","dieciocho","diecinueve",
                         "veinte","veintiuno","veintidÃ³s","veintitrÃ©s","veinticuatro","veinticinco",
                         "veintisÃ©is","veintisiete","veintiocho","veintinueve","treinta"];
            return num <= 30 ? nums[num] : num + " (æ¼”ç¤ºç‰ˆä¸Šé™30)";
        }

        // 4. è¯­éŸ³æ’­æ”¾æ ¸å¿ƒ
        function speak(text) {
            return new Promise((resolve) => {
                const utterance = new SpeechSynthesisUtterance();
                utterance.text = text;
                utterance.lang = 'es-ES';
                utterance.rate = 0.8;
                utterance.onend = resolve;
                
                // ä¼˜å…ˆé€‰æ‹©è¥¿ç­ç‰™è¯­è¯­éŸ³
                const voices = speechSynthesis.getVoices();
                const spanishVoice = voices.find(v => v.lang.startsWith('es'));
                if (spanishVoice) utterance.voice = spanishVoice;
                
                speechSynthesis.speak(utterance);
            });
        }

        // 5. åˆå§‹åŒ–
        async function init() {
            const isSupported = await checkCompatibility();
            if (!isSupported) return;
            
            document.getElementById('status').textContent = "ç‚¹å‡»æŒ‰é’®å¼€å§‹ç»ƒä¹ ";
            
            // æŒ‰é’®åŠŸèƒ½
            document.getElementById('playBtn').onclick = async () => {
                const num = Math.floor(Math.random() * 30) + 1;
                document.getElementById('status').textContent = `${num} - ${getSpanishNum(num)}`;
                await speak(getSpanishNum(num));
            };
            
            // è‡ªåŠ¨æ’­æ”¾
            let autoInterval;
            document.getElementById('autoBtn').onclick = function() {
                if (autoInterval) {
                    clearInterval(autoInterval);
                    autoInterval = null;
                    this.textContent = "è‡ªåŠ¨æ’­æ”¾";
                } else {
                    this.textContent = "åœæ­¢";
                    autoInterval = setInterval(async () => {
                        const num = Math.floor(Math.random() * 30) + 1;
                        document.getElementById('status').textContent = `${num} - ${getSpanishNum(num)}`;
                        await speak(getSpanishNum(num));
                    }, 3000);
                }
            };
        }

        // å¯åŠ¨æ£€æµ‹
        init();
    </script>
</body>
</html>
