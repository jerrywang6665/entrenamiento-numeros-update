<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西语数字听力训练</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            margin: 10px;
        }
        #status {
            color: #FF2D55;
            min-height: 60px;
            font-size: 16px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>西语数字听力训练</h1>
    <div id="status">正在检测浏览器兼容性...</div>
    
    <div id="supportedUI">
        <button id="playBtn">播放数字</button>
        <button id="autoBtn">自动播放</button>
    </div>
    
    <div id="unsupportedUI" class="hidden">
        <h3>😢 您的设备不支持语音功能</h3>
        <p>请尝试以下方法：</p>
        <ol style="text-align: left; margin: 20px;">
            <li>使用 <strong>Chrome/Firefox/Edge</strong> 最新版</li>
            <li>安卓设备需安装 <strong>Google TTS</strong></li>
            <li>iOS 14+ 需使用 <strong>Safari</strong></li>
        </ol>
        <button onclick="window.location.reload()">重新检测</button>
    </div>

    <script>
        // 1. 兼容性检测
        function checkCompatibility() {
            const statusEl = document.getElementById('status');
            
            // 基础API检测
            if (!window.speechSynthesis) {
                showUnsupported("您的浏览器不支持语音合成API");
                return false;
            }
            
            // iOS特殊检测
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                statusEl.textContent = "iOS设备需用户交互授权...";
                return new Promise(resolve => {
                    document.body.addEventListener('touchstart', () => {
                        resolve(true);
                    }, { once: true });
                });
            }
            
            return true;
        }

        // 2. 显示不支持界面
        function showUnsupported(message) {
            document.getElementById('status').textContent = message;
            document.getElementById('supportedUI').classList.add('hidden');
            document.getElementById('unsupportedUI').classList.remove('hidden');
        }

        // 3. 西语数字生成 (1-100)
        function getSpanishNum(num) {
            const nums = ["cero","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez",
                         "once","doce","trece","catorce","quince","dieciséis","diecisiete","dieciocho","diecinueve",
                         "veinte","veintiuno","veintidós","veintitrés","veinticuatro","veinticinco",
                         "veintiséis","veintisiete","veintiocho","veintinueve","treinta"];
            return num <= 30 ? nums[num] : num + " (演示版上限30)";
        }

        // 4. 语音播放核心
        function speak(text) {
            return new Promise((resolve) => {
                const utterance = new SpeechSynthesisUtterance();
                utterance.text = text;
                utterance.lang = 'es-ES';
                utterance.rate = 0.8;
                utterance.onend = resolve;
                
                // 优先选择西班牙语语音
                const voices = speechSynthesis.getVoices();
                const spanishVoice = voices.find(v => v.lang.startsWith('es'));
                if (spanishVoice) utterance.voice = spanishVoice;
                
                speechSynthesis.speak(utterance);
            });
        }

        // 5. 初始化
        async function init() {
            const isSupported = await checkCompatibility();
            if (!isSupported) return;
            
            document.getElementById('status').textContent = "点击按钮开始练习";
            
            // 按钮功能
            document.getElementById('playBtn').onclick = async () => {
                const num = Math.floor(Math.random() * 30) + 1;
                document.getElementById('status').textContent = `${num} - ${getSpanishNum(num)}`;
                await speak(getSpanishNum(num));
            };
            
            // 自动播放
            let autoInterval;
            document.getElementById('autoBtn').onclick = function() {
                if (autoInterval) {
                    clearInterval(autoInterval);
                    autoInterval = null;
                    this.textContent = "自动播放";
                } else {
                    this.textContent = "停止";
                    autoInterval = setInterval(async () => {
                        const num = Math.floor(Math.random() * 30) + 1;
                        document.getElementById('status').textContent = `${num} - ${getSpanishNum(num)}`;
                        await speak(getSpanishNum(num));
                    }, 3000);
                }
            };
        }

        // 启动检测
        init();
    </script>
</body>
</html>
