<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西语数字听力（华为兼容版）</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        button {
            background: #4361ee;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            margin: 10px;
            width: 80%;
        }
        #status {
            min-height: 60px;
            padding: 15px;
        }
    </style>
</head>
<body>
    <h1>西语数字听力训练</h1>
    <div id="status">准备就绪</div>
    <button id="playBtn">播放数字</button>
    <button id="answerBtn" style="display:none;">显示答案</button>

    <script>
        // 华为兼容版语音引擎
        const speechEngine = {
            // 增强版speak方法
            speak: async function(text) {
                return new Promise((resolve) => {
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // 华为设备特殊配置
                    if (this.isHuaweiDevice()) {
                        utterance.lang = 'es-ES';
                        utterance.rate = 0.7; // 放慢语速
                        
                        // 强制使用第一个可用语音
                        const voices = window.speechSynthesis.getVoices();
                        if (voices.length > 0) {
                            utterance.voice = voices[0];
                            console.log("华为设备使用语音:", voices[0].name);
                        }
                    } 
                    // 其他设备标准配置
                    else {
                        utterance.lang = 'es-ES';
                        utterance.rate = 0.85;
                        
                        // 优先选择西班牙语语音
                        const voices = window.speechSynthesis.getVoices();
                        const spanishVoice = voices.find(v => v.lang.startsWith('es'));
                        if (spanishVoice) utterance.voice = spanishVoice;
                    }

                    utterance.onend = resolve;
                    window.speechSynthesis.speak(utterance);
                });
            },
            
            // 检测华为设备
            isHuaweiDevice: function() {
                return /huawei|honor|mate|p\d{2}/i.test(navigator.userAgent);
            }
        };

        // 训练系统
        const trainer = {
            currentNum: 0,
            
            init() {
                // 初始化语音
                window.speechSynthesis.getVoices();
                
                // 按钮事件
                document.getElementById('playBtn').onclick = () => this.playNumber();
                document.getElementById('answerBtn').onclick = () => this.showAnswer();
                
                // iOS兼容处理
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    document.body.addEventListener('touchstart', () => {
                        console.log("iOS语音引擎激活");
                    }, { once: true });
                }
            },
            
            async playNumber() {
                this.currentNum = Math.floor(Math.random() * 100) + 1;
                document.getElementById('status').textContent = "播放中...";
                document.getElementById('answerBtn').style.display = 'none';
                
                try {
                    await speechEngine.speak(this.toSpanish(this.currentNum));
                    document.getElementById('status').textContent = "这是什么数字？";
                    document.getElementById('answerBtn').style.display = 'block';
                } catch (error) {
                    document.getElementById('status').textContent = "播放失败，请重试";
                    console.error(error);
                }
            },
            
            showAnswer() {
                document.getElementById('status').textContent = 
                    `${this.currentNum} - ${this.toSpanish(this.currentNum)}`;
            },
            
            // 西语数字转换（1-100）
            toSpanish(num) {
                const nums = ["cero","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez",
                             "once","doce","trece","catorce","quince","dieciséis","diecisiete","dieciocho","diecinueve",
                             "veinte","veintiuno","veintidós","veintitrés","veinticuatro","veinticinco",
                             "veintiséis","veintisiete","veintiocho","veintinueve","treinta"];
                if (num <= 30) return nums[num];
                
                const tens = ["","","","treinta","cuarenta","cincuenta",
                             "sesenta","setenta","ochenta","noventa"];
                const units = num % 10;
                return tens[Math.floor(num/10)] + (units > 0 ? " y " + nums[units] : "");
            }
        };

        // 启动系统
        trainer.init();
    </script>
</body>
</html>
